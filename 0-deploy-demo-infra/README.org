#+TITLE: Deploying demo infrastructure
#+AUTHOR: James Blair <jablair@redhat.com>
#+DATE: 21st November 2022

This guide will outline the steps to follow to deploy the infrastructure required to run demonstrations. Infrastructure provisioning is performed via [[https://www.ansible.com/][ansible]] using the certified [[https://www.terraform.io/][terraform]] collection.

To run the demo we need four rhel virtual machines, these machines will run our ansible automation platform components, namely the controller, private automation hub, single sign-on, and automation services catalog.

Run the code block below to install our dependencies and run the ansible playbook that will deploy our infrastructure.

#+NAME: Install dependencies and run
#+begin_src tmate
# Export required variables
export TF_VAR_aws_access_key=<changeme>
export TF_VAR_aws_secret_key=<changeme>
export TF_VAR_aws_region=ap-southeast-2
export TF_VAR_subscription_pw=<changeme>
export TF_VAR_gitlab_token=<changeme>

# Install certified terraform collection
ansible-galaxy collection install cloud.terraform

# Run the deploy playbook
ansible-playbook -i localhost demo-infra-deploy.yaml
#+end_src


The code block above will create and configure our new virtual machines. If required the configure playbook can also be run manually post creation using the code block below:

#+NAME: Run the configure playbook
#+begin_src tmate
# Run the configure playbook
ansible-playbook -i controller.rhdemo.win,hub.rhdemo.win,sso.rhdemo.win,catalog.rhdemo.win -u root demo-infra-configure.yaml --key-file rhel-demo-dev-linux-ap-southeast-2.pem
#+end_src
