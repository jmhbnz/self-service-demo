 - name: "Execute terraform plan"
   hosts: localhost
   connection: local

   tasks:

     - name: "Define the backend configuration at init"
       community.general.terraform:
         project_path: "../2-vm-cloud-migration/"
         state: "planned"
         force_init: true
         plan_file: "testing"
         variables:
           aws_access_key: "{{ lookup('env', 'AWS_ACCESS_KEY_ID') }}"
           aws_secret_key: "{{ lookup('env', 'AWS_SECRET_ACCESS_KEY') }}"
       register: plan

     - name: "Output terraform plan"
       debug:
         msg: "{{ plan }}"
